<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily customer visits</title>
    <link rel="icon" href="images/logo1.jpg">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="body">
        <pre>Daily customer visits</pre>
     <form class="form">
        <label for="name">Name :</label>
        <input type="text" class="name" id="name" name="name" required placeholder="Enter your name"><br>

        <label for="custName">customer Name :</label>
        <input type="text" class="custName" id="custName" name="custName" required placeholder="Enter customer name"><br>
        
        <label for="datetime">Date & Time :</label>
        <input type="text" id="datetime" style="width: 200px;" readonly><br>

        <input type="text" id="location" class="location" placeholder="Your location " required style="width: 200px;">
        <button onclick="shareLocation()">Share your location </button><br>
       
        <label for="file">Attachment :</label>
        <input type="file" id="image" name="image" accept="image/*" required><br>

        <button type="submit">Submit</button>
        
       </form>
    </div>
    <script>
        function shareLocation() {
            // تحقق إذا كان المتصفح يدعم API الجغرافي
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(showPosition, showError);
            } else {
                alert("المتصفح الخاص بك لا يدعم مشاركة الموقع الجغرافي.");
            }
        }

        // دالة لعرض الإحداثيات
        function showPosition(position) {
            var latitude = position.coords.latitude;
            var longitude = position.coords.longitude;

            // استدعاء دالة لتحويل الإحداثيات إلى عنوان
            getLocationDetails(latitude, longitude);
        }

        // دالة لتحويل الإحداثيات إلى عنوان باستخدام Google Maps Geocoding API
        function getLocationDetails(lat, lng) {
            var geocodingAPI = `https://maps.googleapis.com/maps/api/geocode/json?latlng=${lat},${lng}&key=AIzaSyDd2talO9EscCPUEbBfy6ffk7Ot0j6aS8U`;

            fetch(geocodingAPI)
                .then(response => response.json())
                .then(data => {
                    if (data.status === "OK") {
                        var address = data.results[0].formatted_address;

                        // إزالة Google Plus Code إن وجد
                        address = removePlusCode(address);

                        // وضع العنوان داخل حقل الإدخال
                        document.getElementById("location").value = address;
                    } else {
                        alert("لم يتم العثور على العنوان.");
                    }
                })
                .catch(error => {
                    console.error("خطأ في جلب العنوان:", error);
                });
        }

        // دالة لإزالة Plus Code من العنوان
        function removePlusCode(address) {
            // التعبير النمطي للبحث عن Plus Code (حروف وأرقام تتبعها علامة زائد)
            var plusCodePattern = /^[A-Z0-9]{3,}\+[A-Z0-9]{2,},\s*/;
            return address.replace(plusCodePattern, '');
        }

        // دالة لمعالجة الأخطاء
        function showError(error) {
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    alert("تم رفض الإذن للحصول على الموقع.");
                    break;
                case error.POSITION_UNAVAILABLE:
                    alert("المعلومات الخاصة بالموقع غير متوفرة.");
                    break;
                case error.TIMEOUT:
                    alert("انتهت مهلة الطلب للحصول على الموقع.");
                    break;
                case error.UNKNOWN_ERROR:
                    alert("حدث خطأ غير معروف.");
                    break;
            }
        }
         // دالة لعرض التاريخ والوقت الحالي في حقل الإدخال
         function showDateTime() {
            var now = new Date();
            var formattedDate = now.toLocaleString(); // تحويل التاريخ والوقت إلى صيغة مناسبة
            document.getElementById("datetime").value = formattedDate;
        }

        // استدعاء دالة عرض الوقت بمجرد تحميل الصفحة
        window.onload = showDateTime;
    </script>
</body>
</html>